{% extends "base.html" %}

{% block content %}
<style>
.profile-card {
    --main-color: #000;
    --submain-color: #78858F;
    --bg-color: #fff;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    border-radius: 20px;
    background: var(--bg-color);
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    overflow: hidden;
}

.profile-card__img {
    height: 192px;
    width: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.profile-card__avatar {
    position: absolute;
    width: 114px;
    height: 114px;
    background: var(--bg-color);
    border-radius: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    top: 135px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.profile-card__avatar-text {
    font-size: 48px;
    font-weight: 700;
    color: #667eea;
}

.profile-card__title {
    margin-top: 70px;
    font-weight: 600;
    font-size: 24px;
    color: var(--main-color);
}

.profile-card__subtitle {
    margin-top: 8px;
    font-weight: 400;
    font-size: 15px;
    color: var(--submain-color);
}

.profile-card__company {
    margin-top: 4px;
    font-weight: 400;
    font-size: 13px;
    color: var(--submain-color);
}

.profile-card__btn {
    margin-top: 20px;
    padding: 10px 24px;
    border: 2px solid var(--main-color);
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    color: var(--main-color);
    background: var(--bg-color);
    text-transform: uppercase;
    transition: all 0.3s;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
}

.profile-card__btn-solid {
    background: var(--main-color);
    color: var(--bg-color);
}

.profile-card__btn:hover {
    background: var(--main-color);
    color: var(--bg-color);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.profile-card__btn-solid:hover {
    background: var(--bg-color);
    color: var(--main-color);
}

.stats-card {
    background: white;
    border-radius: 20px;
    padding: 24px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.chart-container {
    position: relative;
    height: 250px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.info-card {
    background: white;
    border-radius: 20px;
    padding: 24px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.info-item {
    padding: 16px 0;
    border-bottom: 1px solid #f0f0f0;
}

.info-item:last-child {
    border-bottom: none;
}

.info-label {
    font-size: 13px;
    color: #78858F;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 6px;
}

.info-value {
    font-size: 16px;
    color: #000;
    font-weight: 600;
}

.stat-box {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    color: white;
    transition: transform 0.3s;
}

.stat-box:hover {
    transform: translateY(-5px);
}

.stat-number {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 8px;
}

.stat-label {
    font-size: 14px;
    opacity: 0.9;
    font-weight: 500;
}
</style>

<div class="max-w-7xl mx-auto px-4 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Profile Card -->
        <div class="lg:col-span-1">
            <div class="profile-card">
                <div class="profile-card__img">
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: 100%;">
                        <defs>
                            <pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse">
                                <path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/>
                            </pattern>
                        </defs>
                        <rect width="100" height="100" fill="url(#grid)"/>
                        <circle cx="20" cy="30" r="2" fill="rgba(255,255,255,0.3)"/>
                        <circle cx="80" cy="20" r="3" fill="rgba(255,255,255,0.2)"/>
                        <circle cx="70" cy="70" r="2.5" fill="rgba(255,255,255,0.25)"/>
                    </svg>
                </div>
                <div class="profile-card__avatar">
                    <span class="profile-card__avatar-text">{{ user.username[0].upper() }}</span>
                </div>
                <h1 class="profile-card__title">{{ user.username }}</h1>
                <p class="profile-card__subtitle">{{ user.user_type.value }}</p>
                <p class="profile-card__company">{{ user.company.name if user.company else 'No Company' }}</p>

                <div style="display: flex; gap: 12px; margin-top: 24px; margin-bottom: 24px;">
                    <a href="{{ url_for('auth.edit_profile') }}" class="profile-card__btn profile-card__btn-solid">
                        Edit Profile
                    </a>
                    <a href="{{ url_for('auth.change_password') }}" class="profile-card__btn">
                        Password
                    </a>
                </div>
            </div>
        </div>

        <!-- Right Section -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Ticket Statistics with Chart -->
            <div class="stats-card">
                <h2 class="text-xl font-bold mb-6" style="color: #000;">Ticket Ownership</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Chart -->
                    <div class="chart-container">
                        <canvas id="ticketChart"></canvas>
                    </div>

                    <!-- Stats Boxes -->
                    <div class="space-y-4">
                        <div class="stat-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="stat-number">{{ ticket_stats.total }}</div>
                            <div class="stat-label">Total Tickets</div>
                        </div>
                        <div class="stat-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="stat-number">{{ ticket_stats.open }}</div>
                            <div class="stat-label">Open Tickets</div>
                        </div>
                        <div class="stat-box" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <div class="stat-number">{{ ticket_stats.closed }}</div>
                            <div class="stat-label">Closed Tickets</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Information -->
            <div class="info-card">
                <h2 class="text-xl font-bold mb-6" style="color: #000;">Account Details</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8">
                    <div class="info-item">
                        <div class="info-label">Username</div>
                        <div class="info-value">{{ user.username }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Email Address</div>
                        <div class="info-value">{{ user.email }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">User Role</div>
                        <div class="info-value">{{ user.user_type.value }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Company</div>
                        <div class="info-value">{{ user.company.name if user.company else 'Truelog' }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('ticketChart');

    const data = {
        labels: ['Open Tickets', 'Closed Tickets'],
        datasets: [{
            data: [{{ ticket_stats.open }}, {{ ticket_stats.closed }}],
            backgroundColor: [
                'rgba(245, 87, 108, 0.8)',
                'rgba(79, 172, 254, 0.8)'
            ],
            borderColor: [
                'rgba(245, 87, 108, 1)',
                'rgba(79, 172, 254, 1)'
            ],
            borderWidth: 2
        }]
    };

    new Chart(ctx, {
        type: 'doughnut',
        data: data,
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        font: {
                            size: 14,
                            weight: '600'
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    padding: 12,
                    titleFont: {
                        size: 14,
                        weight: 'bold'
                    },
                    bodyFont: {
                        size: 13
                    },
                    borderColor: 'rgba(255,255,255,0.2)',
                    borderWidth: 1
                }
            },
            cutout: '65%'
        }
    });
});
</script>
{% endblock %} 