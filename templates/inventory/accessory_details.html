{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Back Button -->
    <div class="mb-6">
        <a href="{{ url_for('inventory.view_accessories') }}" class="text-blue-600 hover:text-blue-800 flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            Back to Accessories
        </a>
    </div>

    <!-- Accessory Header -->
    <div class="bg-white shadow rounded-lg p-4 sm:p-6 mb-6">
        <div class="flex flex-col sm:flex-row justify-between items-start gap-4">
            <div class="flex items-center">
                <div class="mr-3">
                    <svg class="w-8 h-8 {% if accessory.status == 'Available' %}text-green-500{% else %}text-red-500{% endif %}" 
                         fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        {% if accessory.category == 'Keyboard' %}
                        <!-- Keyboard icon -->
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M3 5h18v9a2 2 0 01-2 2H5a2 2 0 01-2-2V5zm1 3h2m2 0h2m2 0h2m2 0h2m2 0h2M5 11h2m2 0h2m2 0h2m2 0h2m2 0h2M6 14h12"/>
                        {% elif accessory.category == 'Mouse' %}
                        <!-- Mouse icon -->
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M12 3v10M8 6a4 4 0 018 0v7a4 4 0 01-8 0V6z"/>
                        {% elif accessory.category == 'Monitor' %}
                        <!-- Monitor icon -->
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        {% elif accessory.category == 'Docking Station' %}
                        <!-- Docking Station icon -->
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"/>
                        {% elif accessory.category == 'Cable' %}
                        <!-- Cable icon -->
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M5 12h14M12 5v14"/>
                        {% elif accessory.category == 'Power Adapter' %}
                        <!-- Power Adapter icon -->
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        {% elif accessory.category == 'Headset' %}
                        <!-- Headset icon -->
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M19.95 11A7.97 7.97 0 0012 4a7.97 7.97 0 00-7.95 7h2.8c.34-2.34 2.2-4.2 5.15-4.2s4.81 1.86 5.15 4.2h2.8zM12 8v8m-5 0h-.5a2 2 0 01-2-2v-2a2 2 0 012-2H7m10 0h.5a2 2 0 012 2v2a2 2 0 01-2 2H17"/>
                        {% elif accessory.category == 'Audio' %}
                        <!-- Audio headphone icon -->
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M8 14.5a2.5 2.5 0 01-2.5-2.5V9.45a7 7 0 0114 0V12a2.5 2.5 0 01-2.5 2.5M5.5 12V9.45a8.5 8.5 0 0117 0V12"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M8 14.5h.5v4a1.5 1.5 0 01-1.5 1.5h-2A1.5 1.5 0 013.5 18.5v-4a2.5 2.5 0 012.5-2.5h.5M16 14.5h.5a2.5 2.5 0 012.5 2.5v4a1.5 1.5 0 01-1.5 1.5h-2a1.5 1.5 0 01-1.5-1.5v-4h.5"/>
                        {% else %}
                        <!-- Generic accessory icon for 'Other' or unknown categories -->
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
                        {% endif %}
                    </svg>
                </div>
                <div>
                    <h1 class="text-xl sm:text-2xl font-bold text-gray-900">{{ accessory.name }}</h1>
                    <div class="flex items-center mt-1 space-x-2">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                            {% if accessory.status == 'Available' %}
                                bg-green-100 text-green-800 border border-green-200
                            {% else %}
                                bg-red-100 text-red-800 border border-red-200
                            {% endif %}">
                            {{ accessory.status }}
                        </span>
                    </div>
                </div>
            </div>
            {% if current_user.permissions and current_user.permissions.can_edit_accessories %}
            <div class="flex space-x-2">
                <a href="{{ url_for('inventory.edit_accessory', id=accessory.id) }}" 
                   class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium transition-colors duration-150">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                    Edit
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="mb-4 border-b border-gray-200">
        <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" role="tablist">
            <li class="mr-2" role="presentation">
                <button class="inline-flex items-center p-4 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 tab-button active" 
                        id="details-tab" 
                        data-target="details-content"
                        type="button" 
                        role="tab">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                    Details
                </button>
            </li>
            <li class="mr-2" role="presentation">
                <button class="inline-flex items-center p-4 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 tab-button" 
                        id="transactions-tab" 
                        data-target="transactions-content"
                        type="button" 
                        role="tab">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
                    </svg>
                    Transactions
                </button>
            </li>
            {% if is_admin %}
            <li class="mr-2" role="presentation">
                <button class="inline-flex items-center p-4 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 tab-button" 
                        id="add-stock-tab" 
                        data-target="add-stock-content"
                        type="button" 
                        role="tab">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    Add Stock
                </button>
            </li>
            {% endif %}
        </ul>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
        <!-- Details Tab Content -->
        <div id="details-content" class="tab-pane active">
            <!-- Basic Information -->
            <div class="bg-white shadow rounded-lg p-6 mb-6">
                <div class="flex items-center mb-4">
                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <h2 class="text-lg font-semibold text-gray-900">Basic Information</h2>
                </div>
                <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Category</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ accessory.category }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Manufacturer</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ accessory.manufacturer }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Model Number</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ accessory.model_no or 'N/A' }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Country</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ accessory.country or 'N/A' }}</dd>
                    </div>
                    {% if accessory.aliases %}
                    <div class="md:col-span-2">
                        <dt class="text-sm font-medium text-gray-500">Alias Names</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            <div class="flex flex-wrap gap-2">
                                {% for alias in accessory.aliases %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200">
                                    {{ alias.alias_name }}
                                </span>
                                {% endfor %}
                            </div>
                        </dd>
                    </div>
                    {% endif %}
                </dl>
            </div>

            <!-- Inventory Status -->
            <div class="bg-white shadow rounded-lg p-6 mb-6">
                <div class="flex items-center mb-4">
                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                    </svg>
                    <h2 class="text-lg font-semibold text-gray-900">Inventory Status</h2>
                </div>
                <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Total Quantity</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ accessory.total_quantity }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Available Quantity</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ accessory.available_quantity }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Current Status</dt>
                        <dd class="mt-1">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                {% if accessory.status == 'Available' %}
                                    bg-green-100 text-green-800 border border-green-200
                                {% else %}
                                    bg-red-100 text-red-800 border border-red-200
                                {% endif %}">
                                {{ accessory.status }}
                            </span>
                        </dd>
                    </div>
                </dl>
            </div>

            <!-- Checkout Form -->
            {% if accessory.available_quantity > 0 %}
            <div class="bg-white shadow rounded-lg p-6 mb-6">
                <div class="flex items-center mb-4">
                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                    </svg>
                    <h2 class="text-lg font-semibold text-gray-900">Checkout Accessory</h2>
                </div>
                <form action="{{ url_for('inventory.checkout_accessory', id=accessory.id) }}" method="POST" class="space-y-4">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <!-- Customer Selection -->
                    <div>
                        <label for="customer_id" class="block text-sm font-medium text-gray-700">Select Customer</label>
                        <select id="customer_id" name="customer_id" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <option value="">Select a customer...</option>
                            {% for customer in customers %}
                            <option value="{{ customer.id }}">{{ customer.name }} ({{ customer.email }})</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Quantity Selection -->
                    <div>
                        <label for="quantity" class="block text-sm font-medium text-gray-700">Quantity</label>
                        <input type="number" id="quantity" name="quantity" min="1" max="{{ accessory.available_quantity }}" value="1" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <p class="mt-1 text-sm text-gray-500">Maximum available: {{ accessory.available_quantity }}</p>
                    </div>

                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        Checkout
                    </button>
                </form>
            </div>
            {% endif %}

            <!-- Additional Information -->
            <div class="bg-white shadow rounded-lg p-6 mb-6">
                <div class="flex items-center mb-4">
                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <h2 class="text-lg font-semibold text-gray-900">Additional Information</h2>
                </div>
                <dl class="grid grid-cols-1 gap-4">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Notes</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ accessory.notes or 'No notes available' }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Created At</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ accessory.created_at.strftime('%Y-%m-%d %H:%M:%S') if accessory.created_at else 'Not available' }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Last Updated</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ accessory.updated_at.strftime('%Y-%m-%d %H:%M:%S') if accessory.updated_at else 'Not available' }}</dd>
                    </div>
                </dl>
            </div>
        </div>

        <!-- Transactions Tab Content -->
        <div id="transactions-content" class="tab-pane hidden">
            <div class="bg-white shadow rounded-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3">Transaction #</th>
                                <th scope="col" class="px-6 py-3">Customer</th>
                                <th scope="col" class="px-6 py-3">Type</th>
                                <th scope="col" class="px-6 py-3">Quantity</th>
                                <th scope="col" class="px-6 py-3">Date</th>
                                <th scope="col" class="px-6 py-3">Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if accessory.transactions %}
                                {% for transaction in accessory.transactions %}
                                <tr class="bg-white border-b hover:bg-gray-50">
                                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                        {{ transaction.transaction_number }}
                                    </th>
                                    <td class="px-6 py-4">
                                        {% if transaction.customer %}
                                            {{ transaction.customer.name }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </td>
                                    <td class="px-6 py-4">
                                        <span class="px-2 py-1 rounded-full text-xs font-semibold 
                                            {% if transaction.transaction_type == 'checkout' %}
                                                bg-green-100 text-green-800
                                            {% elif transaction.transaction_type == 'checkin' %}
                                                bg-blue-100 text-blue-800
                                            {% elif transaction.transaction_type == 'add_stock' %}
                                                bg-yellow-100 text-yellow-800
                                            {% else %}
                                                bg-gray-100 text-gray-800
                                            {% endif %}">
                                            {{ transaction.transaction_type|capitalize }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4">
                                        {{ transaction.quantity }}
                                    </td>
                                    <td class="px-6 py-4">
                                        {{ transaction.transaction_date.strftime('%Y-%m-%d %H:%M:%S') if transaction.transaction_date else 'N/A' }}
                                    </td>
                                    <td class="px-6 py-4">
                                        {{ transaction.notes or 'No notes' }}
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                                        No transactions found for this accessory
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        {% if is_admin %}
        <!-- Add Stock Tab Content -->
        <div id="add-stock-content" class="tab-pane hidden">
            <div class="bg-white shadow rounded-lg p-6">
                <div class="flex items-center mb-4">
                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    <h2 class="text-lg font-semibold text-gray-900">Add Stock to {{ accessory.name }}</h2>
                </div>
                
                <!-- Current Stock Information -->
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <h3 class="text-sm font-medium text-gray-700 mb-2">Current Stock Information</h3>
                    <dl class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Total Quantity</dt>
                            <dd class="mt-1 text-sm text-gray-900">{{ accessory.total_quantity }}</dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Available Quantity</dt>
                            <dd class="mt-1 text-sm text-gray-900">{{ accessory.available_quantity }}</dd>
                        </div>
                    </dl>
                </div>
                
                <form action="{{ url_for('inventory.add_accessory_stock', id=accessory.id) }}" method="POST" class="space-y-4">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <!-- Additional Quantity -->
                    <div>
                        <label for="additional_quantity" class="block text-sm font-medium text-gray-700">Additional Quantity</label>
                        <input type="number" 
                               id="additional_quantity" 
                               name="additional_quantity" 
                               required
                               min="1"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <p class="mt-1 text-sm text-gray-500">Enter the number of new items to add to the current stock.</p>
                    </div>

                    <!-- Notes -->
                    <div>
                        <label for="notes" class="block text-sm font-medium text-gray-700">Notes</label>
                        <textarea id="notes" 
                                 name="notes" 
                                 rows="3"
                                 class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                                 placeholder="Enter any notes about this stock addition"></textarea>
                    </div>

                    <!-- Submit Button -->
                    <div>
                        <button type="submit" 
                                class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                            Add Stock
                        </button>
                    </div>
                </form>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Delete Confirmation Form -->
    <form id="deleteForm" action="{{ url_for('inventory.delete_accessory', id=accessory.id) }}" method="POST" class="hidden">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    </form>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab switching functionality
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            // Remove active class from all buttons and panes
            tabButtons.forEach(btn => {
                btn.classList.remove('active', 'border-blue-600', 'text-blue-600');
                btn.classList.add('border-transparent');
            });
            tabPanes.forEach(pane => pane.classList.add('hidden'));

            // Add active class to clicked button and its target pane
            button.classList.add('active', 'border-blue-600', 'text-blue-600');
            const targetId = button.getAttribute('data-target');
            const targetPane = document.getElementById(targetId);
            targetPane.classList.remove('hidden');

            // Load transactions if transactions tab is clicked
            if (targetId === 'transactions-content') {
                loadTransactions();
            }
        });
    });

    // Initialize the first tab as active
    const activeTab = document.querySelector('.tab-button.active');
    if (activeTab) {
        activeTab.classList.add('border-blue-600', 'text-blue-600');
        const targetId = activeTab.getAttribute('data-target');
        const targetPane = document.getElementById(targetId);
        targetPane.classList.remove('hidden');
    }

    // Function to load transactions
    function loadTransactions() {
        const transactionsTableBody = document.querySelector('#transactions-content tbody');
        const loadingRow = document.createElement('tr');
        loadingRow.innerHTML = `
            <td colspan="6" class="px-6 py-4 text-center">
                <div class="flex items-center justify-center">
                    <svg class="animate-spin h-5 w-5 mr-3 text-blue-600" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Loading transactions...
                </div>
            </td>
        `;
        transactionsTableBody.innerHTML = '';
        transactionsTableBody.appendChild(loadingRow);

        fetch(`/inventory/api/accessories/{{ accessory.id }}/transactions`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                transactionsTableBody.innerHTML = '';
                if (data.error) {
                    throw new Error(data.error);
                }
                if (!Array.isArray(data) || data.length === 0) {
                    const emptyRow = document.createElement('tr');
                    emptyRow.innerHTML = `
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                            No transactions found for this accessory
                        </td>
                    `;
                    transactionsTableBody.appendChild(emptyRow);
                } else {
                    data.forEach(transaction => {
                        const row = document.createElement('tr');
                        row.className = 'bg-white border-b hover:bg-gray-50';
                        row.innerHTML = `
                            <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                ${transaction.transaction_number || 'N/A'}
                            </td>
                            <td class="px-6 py-4">
                                ${transaction.customer || 'N/A'}
                            </td>
                            <td class="px-6 py-4">
                                <span class="px-2 py-1 rounded-full text-xs font-semibold 
                                    ${transaction.transaction_type === 'Checkout' ? 'bg-green-100 text-green-800' :
                                      transaction.transaction_type === 'Checkin' ? 'bg-blue-100 text-blue-800' :
                                      transaction.transaction_type === 'Add Stock' ? 'bg-yellow-100 text-yellow-800' :
                                      'bg-gray-100 text-gray-800'}">
                                    ${transaction.transaction_type || 'Unknown'}
                                </span>
                            </td>
                            <td class="px-6 py-4">${transaction.quantity || '0'}</td>
                            <td class="px-6 py-4">${transaction.transaction_date || 'N/A'}</td>
                            <td class="px-6 py-4">${transaction.notes || 'No notes'}</td>
                        `;
                        transactionsTableBody.appendChild(row);
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
                transactionsTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-red-500">
                            Error loading transactions. Please try again later.
                        </td>
                    </tr>
                `;
            });
    }
});
</script>
{% endblock %} 