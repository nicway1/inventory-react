{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Back Button -->
    <div class="mb-6">
        <a href="{{ url_for('inventory.view_inventory_sf') }}" 
           class="text-blue-600 hover:text-blue-800 flex items-center">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            Back to Inventory
        </a>
    </div>

    <!-- Asset Header -->
    <div class="bg-white shadow rounded-lg p-4 sm:p-6 mb-4 sm:mb-6">
        <div class="flex flex-col sm:flex-row justify-between items-start gap-4">
            <div class="w-full sm:w-auto flex items-start">
                <div class="mr-3 mt-1">
                    <svg class="w-8 h-8 {% if asset.status and asset.status.name == 'IN_STOCK' %}
                        text-blue-500
                    {% elif asset.status and asset.status.name == 'DEPLOYED' %}
                        text-green-500
                    {% elif asset.status and asset.status.name == 'SHIPPED' %}
                        text-yellow-500
                    {% elif asset.status and asset.status.name == 'ARCHIVED' %}
                        text-red-500
                    {% elif asset.status and asset.status.name == 'DISPOSED' %}
                        text-red-500
                    {% else %}
                        text-gray-500
                    {% endif %}" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M3 5a2 2 0 012-2h10a2 2 0 012 2v8a2 2 0 01-2 2h-2.22l.123.489.804.804A1 1 0 0113 18H7a1 1 0 01-.707-1.707l.804-.804L7.22 15H5a2 2 0 01-2-2V5zm5.771 7H5V5h10v7H8.771z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-xl sm:text-2xl font-bold text-gray-900 break-words">
                        {{ asset.name or asset.hardware_type or asset.model or "Unnamed Asset" }}
                    </h1>
                    <div class="flex items-center mt-1 space-x-2">
                        <p class="text-sm text-gray-500">Asset ID: {{ asset.asset_tag }}</p>
                        <span class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full {% if asset.status and asset.status.value == 'IN_STOCK' %}
                            bg-blue-100 text-blue-800
                        {% elif asset.status and asset.status.value == 'DEPLOYED' %}
                            bg-green-100 text-green-800
                        {% elif asset.status and asset.status.value == 'SHIPPED' %}
                            bg-yellow-100 text-yellow-800
                        {% elif asset.status and asset.status.value == 'ARCHIVED' %}
                            bg-red-100 text-red-800
                        {% elif asset.status and asset.status.value == 'DISPOSED' %}
                            bg-red-100 text-red-800
                        {% else %}
                            bg-gray-100 text-gray-800
                        {% endif %}">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                {% if asset.status and asset.status.value == 'IN_STOCK' %}
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
                                {% elif asset.status and asset.status.value == 'DEPLOYED' %}
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                {% elif asset.status and asset.status.value == 'SHIPPED' %}
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                {% elif asset.status and asset.status.value == 'ARCHIVED' %}
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8M10 12h4"/>
                                {% elif asset.status and asset.status.value == 'DISPOSED' %}
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                {% else %}
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                {% endif %}
                            </svg>
                            {{ asset.status.value if asset.status else 'Unknown' }}
                        </span>
                    </div>
                </div>
            </div>
            <div class="flex flex-wrap items-center gap-2 w-full sm:w-auto">
                {% if current_user.permissions and current_user.permissions.can_edit_assets %}
                <a href="{{ url_for('inventory.edit_asset', asset_id=asset.id) }}"
                   class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium transition-colors duration-150">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                    Edit
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Customer Information (when deployed) -->
    {% if asset.status and asset.status.value == 'DEPLOYED' %}
    <div class="bg-white shadow rounded-lg p-6 mb-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Customer Information</h2>
        {% if asset.customer_user %}
        <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <dt class="text-sm font-medium text-gray-500">Assigned To</dt>
                <dd class="text-sm text-gray-900">{{ asset.customer_user.name }}</dd>
            </div>
            <div>
                <dt class="text-sm font-medium text-gray-500">Contact Number</dt>
                <dd class="text-sm text-gray-900">{{ asset.customer_user.contact_number or 'N/A' }}</dd>
            </div>
            <div>
                <dt class="text-sm font-medium text-gray-500">Email</dt>
                <dd class="text-sm text-gray-900">{{ asset.customer_user.email }}</dd>
            </div>
            <div>
                <dt class="text-sm font-medium text-gray-500">Address</dt>
                <dd class="text-sm text-gray-900">{{ asset.customer_user.address or 'N/A' }}</dd>
            </div>
            <div>
                <dt class="text-sm font-medium text-gray-500">Country</dt>
                <dd class="text-sm text-gray-900">{{ asset.customer_user.country or 'N/A' }}</dd>
            </div>
        </dl>
        {% else %}
        <div class="text-sm text-gray-500">
            <p>No customer information available.</p>
            {% if asset.customer %}
            <p class="mt-2">Legacy Customer Name: {{ asset.customer }}</p>
            {% endif %}
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Tab Navigation -->
    <div class="mb-4 border-b border-gray-200">
        <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" role="tablist">
            <li class="mr-2" role="presentation">
                <button class="inline-flex items-center p-4 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 tab-button active" 
                        id="details-tab" 
                        data-target="details-content"
                        type="button" 
                        role="tab">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                    Details
                </button>
            </li>
            <li class="mr-2" role="presentation">
                <button class="inline-flex items-center p-4 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 tab-button" 
                        id="history-tab" 
                        data-target="history-content"
                        type="button" 
                        role="tab">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    History
                </button>
            </li>
            <li class="mr-2" role="presentation">
                <button class="inline-flex items-center p-4 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 tab-button" 
                        id="transactions-tab" 
                        data-target="transactions-content"
                        type="button" 
                        role="tab">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
                    </svg>
                    Transactions
                </button>
            </li>
            {% if current_user.is_admin %}
            <li class="mr-2" role="presentation">
                <button class="inline-flex items-center p-4 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 tab-button" 
                        id="create-customer-tab" 
                        data-target="create-customer-content"
                        type="button" 
                        role="tab">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                    </svg>
                    Create Customer
                </button>
            </li>
            {% endif %}
        </ul>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
        <!-- Details Tab Content -->
        <div id="details-content" class="tab-pane active">
            <!-- Asset Information Sections -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Basic Information -->
        <div class="bg-white shadow rounded-lg p-6">
                    <div class="flex items-center mb-4">
                        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <h2 class="text-lg font-semibold text-gray-900">Basic Information</h2>
                    </div>
            <dl class="space-y-3">
                        <div class="grid grid-cols-[180px,1fr] items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"/>
                                </svg>
                                Serial Number
                            </dt>
                    <dd class="text-sm text-gray-900">{{ asset.serial_num or 'N/A' }}</dd>
                </div>
                        <div class="grid grid-cols-[180px,1fr] items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                </svg>
                                Model
                            </dt>
                    <dd class="text-sm text-gray-900">{{ asset.model or 'N/A' }}</dd>
                </div>
                        <div class="grid grid-cols-[180px,1fr] items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
                                </svg>
                                Asset Type
                            </dt>
                            <dd class="text-sm text-gray-900 flex items-center">
                                {% if asset.asset_type == 'APPLE' %}
                                <svg class="w-4 h-4 mr-2" viewBox="0 0 384 512" fill="currentColor">
                                    <path d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"/>
                                </svg>
                                {% endif %}
                                {{ asset.asset_type or 'N/A' }}
                            </dd>
                </div>
                        <div class="grid grid-cols-[180px,1fr] items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                                </svg>
                                Hardware Type
                            </dt>
                    <dd class="text-sm text-gray-900">{{ asset.hardware_type or 'N/A' }}</dd>
                </div>
                        <div class="grid grid-cols-[180px,1fr] items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                                </svg>
                                PO Number
                            </dt>
                    <dd class="text-sm text-gray-900">{{ asset.po or 'N/A' }}</dd>
                </div>
                        <div class="grid grid-cols-[180px,1fr] items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                                </svg>
                                Receiving Date
                            </dt>
                    <dd class="text-sm text-gray-900">{{ asset.receiving_date.strftime('%Y-%m-%d') if asset.receiving_date else 'N/A' }}</dd>
                </div>
            </dl>
        </div>

        <!-- Hardware Specifications -->
        <div class="bg-white shadow rounded-lg p-6">
                    <div class="flex items-center mb-4">
                        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
                        </svg>
                        <h2 class="text-lg font-semibold text-gray-900">Hardware Specifications</h2>
                    </div>
            <dl class="space-y-3">
                        <div class="flex items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                </svg>
                                Model Name
                            </dt>
                            <dd class="text-sm text-gray-900 ml-2">{{ asset.name or 'N/A' }}</dd>
                </div>
                        <div class="flex items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                                </svg>
                                CPU Type
                            </dt>
                            <dd class="text-sm text-gray-900 ml-2">{{ asset.cpu_type or 'N/A' }}</dd>
                </div>
                        <div class="flex items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"/>
                                </svg>
                                CPU Cores
                            </dt>
                            <dd class="text-sm text-gray-900 ml-2">{{ asset.cpu_cores or 'N/A' }}</dd>
                </div>
                        <div class="flex items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
                                </svg>
                                GPU Cores
                            </dt>
                            <dd class="text-sm text-gray-900 ml-2">{{ asset.gpu_cores or 'N/A' }}</dd>
                </div>
                        <div class="flex items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                Memory
                            </dt>
                            <dd class="text-sm text-gray-900 ml-2">{{ (asset.memory ~ ' GB') if asset.memory and not asset.memory.endswith('GB') else (asset.memory or 'N/A') }}</dd>
                </div>
                        <div class="flex items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
                                </svg>
                                Hard Drive
                            </dt>
                            <dd class="text-sm text-gray-900 ml-2">{{ (asset.harddrive ~ ' GB') if asset.harddrive and not asset.harddrive.endswith('GB') else (asset.harddrive or 'N/A') }}</dd>
                </div>
            </dl>
        </div>

        <!-- Status and Condition -->
        <div class="bg-white shadow rounded-lg p-6">
                    <div class="flex items-center mb-4">
                        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <h2 class="text-lg font-semibold text-gray-900">Status and Condition</h2>
                    </div>
            <dl class="space-y-3">
                        <div class="grid grid-cols-[180px,1fr] items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Condition
                            </dt>
                            <dd class="text-sm text-gray-900">{{ asset.condition or 'N/A' }}</dd>
                        </div>
                        <div class="grid grid-cols-[180px,1fr] items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                                Erased
                            </dt>
                            <dd class="text-sm text-gray-900 flex items-center gap-2">
                                <span>{{ asset.erased or 'N/A' }}</span>
                                {% if not asset.erased or asset.erased.upper() not in ['COMPLETED', 'EWASTE'] %}
                                <div class="flex gap-2">
                                    <button onclick="updateEraseStatus('COMPLETED')" 
                                            class="px-2 py-1 text-xs font-medium text-white bg-green-600 hover:bg-green-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                        Set COMPLETED
                                    </button>
                                    <button onclick="updateEraseStatus('EWASTE')" 
                                            class="px-2 py-1 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                        Set EWASTE
                                    </button>
                                </div>
                                {% endif %}
                            </dd>
                        </div>
                        <div class="grid grid-cols-[180px,1fr] items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/>
                                </svg>
                                Keyboard
                            </dt>
                            <dd class="text-sm text-gray-900">{{ asset.keyboard or 'N/A' }}</dd>
                        </div>
                        <div class="grid grid-cols-[180px,1fr] items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                </svg>
                                Charger
                            </dt>
                            <dd class="text-sm text-gray-900">{{ asset.charger or 'N/A' }}</dd>
                        </div>
                        <div class="grid grid-cols-[180px,1fr] items-center">
                            <dt class="flex items-center text-sm font-medium text-gray-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
                                </svg>
                                Diagnostics
                            </dt>
                            <dd class="text-sm text-gray-900">{{ asset.diag or 'N/A' }}</dd>
                        </div>
            </dl>
        </div>

        <!-- Location and Assignment -->
        <div class="bg-white shadow rounded-lg p-6">
                    <div class="flex items-center mb-4">
                        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <h2 class="text-lg font-semibold text-gray-900">Location and Assignment</h2>
                    </div>
            <dl class="space-y-3">
                <div>
                    <dt class="text-sm font-medium text-gray-500">Asset Company</dt>
                    <dd class="text-sm text-gray-900">
                        {% if asset_company_display %}
                            {{ asset_company_display }}
                        {% else %}
                            N/A
                        {% endif %}
                    </dd>
                </div>

                {% if asset.status and asset.status.name == 'DEPLOYED' and asset.customer_user %}
                <div class="mt-4 pt-4 border-t border-gray-200">
                    <dt class="text-sm font-medium text-gray-500">Current Customer</dt>
                    <dd class="text-sm text-gray-900">
                        {{ asset.customer_user.name }}
                        <div class="mt-2 text-xs text-gray-500">
                            <p>Contact: {{ asset.customer_user.contact_number or 'N/A' }}</p>
                            <p>Email: {{ asset.customer_user.email or 'N/A' }}</p>
                            <p>Address: {{ asset.customer_user.address or 'N/A' }}</p>
                        </div>
                    </dd>
                </div>
                {% endif %}

                <div>
                    <dt class="text-sm font-medium text-gray-500">Country</dt>
                    <dd class="text-sm text-gray-900">{{ asset.country or 'N/A' }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Inventory Status</dt>
                    <dd class="mt-2">
                        <div class="flex flex-col space-y-3">
                            <div class="flex items-center">
                                        <span class="inline-flex items-center px-3 py-1.5 rounded-full {% if asset.status and asset.status.name == 'IN_STOCK' %}
                                            bg-blue-50 text-blue-700 ring-1 ring-blue-600/20
                                {% elif asset.status and asset.status.name == 'DEPLOYED' %}
                                            bg-emerald-50 text-emerald-700 ring-1 ring-emerald-600/20
                                {% elif asset.status and asset.status.name == 'SHIPPED' %}
                                            bg-amber-50 text-amber-700 ring-1 ring-amber-600/20
                                {% elif asset.status and asset.status.name == 'ARCHIVED' %}
                                            bg-gray-50 text-gray-700 ring-1 ring-gray-600/20
                                {% elif asset.status and asset.status.name == 'DISPOSED' %}
                                            bg-red-50 text-red-700 ring-1 ring-red-600/20
                                {% else %}
                                            bg-gray-50 text-gray-700 ring-1 ring-gray-600/20
                                {% endif %}">
                                            <svg class="w-4 h-4 mr-1.5 {% if asset.status and asset.status.name == 'IN_STOCK' %}
                                                text-blue-700
                                            {% elif asset.status and asset.status.name == 'DEPLOYED' %}
                                                text-emerald-700
                                            {% elif asset.status and asset.status.name == 'SHIPPED' %}
                                                text-amber-700
                                            {% elif asset.status and asset.status.name == 'ARCHIVED' %}
                                                text-gray-700
                                            {% elif asset.status and asset.status.name == 'DISPOSED' %}
                                                text-red-700
                                            {% else %}
                                                text-gray-700
                                            {% endif %}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                {% if asset.status and asset.status.name == 'IN_STOCK' %}
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
                                                {% elif asset.status and asset.status.name == 'DEPLOYED' %}
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                {% elif asset.status and asset.status.name == 'SHIPPED' %}
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                                {% elif asset.status and asset.status.name == 'ARCHIVED' %}
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8M10 12h4"/>
                                                {% elif asset.status and asset.status.name == 'DISPOSED' %}
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                                {% else %}
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                {% endif %}
                                            </svg>
                                    {{ asset.status.value if asset.status else 'Unknown' }}
                                </span>
                            </div>

                            {% if asset.status and asset.status.name == 'DISPOSED' %}
                            <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium">
                                            Asset was disposed
                                        </p>
                                        <p class="mt-1 text-sm">
                                            Disposal date: {{ asset.history[0].created_at.strftime('%Y-%m-%d %H:%M:%S') if asset.history else 'N/A' }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            {% set erased_value = asset.erased.strip().upper() if asset.erased else '' %}
                            {% if erased_value == 'PHYSICALLY DEFECTIVE' and user.is_super_admin and asset.status.name != 'DISPOSED' %}
                            <form action="{{ url_for('inventory.update_asset_status', asset_id=asset.id) }}" 
                                  method="POST" 
                                  class="inline"
                                  onsubmit="return confirm('Are you sure you want to dispose of this asset? This action cannot be undone.');">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <input type="hidden" name="status" value="DISPOSED">
                                <button type="submit" class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg bg-red-50 text-red-700 border border-red-200 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                    Dispose Asset
                                </button>
                            </form>
                            {% endif %}

                            {% if erased_value not in ['COMPLETED', 'YES', 'PHYSICALLY DEFECTIVE'] %}
                            <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium">
                                            Asset is not deployable: Data erasure is required
                                        </p>
                                        <p class="mt-1 text-sm">
                                            Current erased status: {{ asset.erased or 'Not completed' }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            {% if asset.status and asset.status.name == 'IN_STOCK' %}
                                {% if erased_value in ['COMPLETED', 'YES'] and current_user.is_admin %}
                                <form action="{{ url_for('inventory.update_asset_status', asset_id=asset.id) }}" method="POST" class="inline">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <input type="hidden" name="status" value="DEPLOYED">
                                    <div class="flex items-center space-x-2">
                                        <select name="customer_id" class="text-sm rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500" required>
                                            <option value="">Select Customer</option>
                                            {% for customer in customers %}
                                            <option value="{{ customer.id }}">{{ customer.name }}</option>
                                            {% endfor %}
                                        </select>
                                        <button type="submit" class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg bg-green-50 text-green-700 border border-green-200 hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                            Mark as Deployed
                                        </button>
                                    </div>
                                </form>
                                {% endif %}
                            {% endif %}

                            {% if asset.status and asset.status.name == 'DEPLOYED' %}
                            <form action="{{ url_for('inventory.update_asset_status', asset_id=asset.id) }}" method="POST" class="inline">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <input type="hidden" name="status" value="IN_STOCK">
                                <button type="submit" class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                                    </svg>
                                    Return to Stock
                                </button>
                            </form>
                            {% endif %}
                        </div>
                    </dd>
                </div>
            </dl>
        </div>
    </div>
        </div>

        <!-- History Tab Content -->
        <div id="history-content" class="tab-pane hidden">
            {% if asset.history %}
            <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
                <table class="w-full text-sm text-left text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3">Date</th>
                            <th scope="col" class="px-6 py-3">User</th>
                            <th scope="col" class="px-6 py-3">Action</th>
                            <th scope="col" class="px-6 py-3">Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in asset.history %}
                        <tr class="bg-white border-b hover:bg-gray-50">
                            <td class="px-6 py-4">
                                {{ entry.created_at.strftime('%Y-%m-%d %H:%M:%S') if entry.created_at else 'N/A' }}
                            </td>
                            <td class="px-6 py-4">
                                {{ entry.user.username if entry.user else 'System' }}
                            </td>
                            <td class="px-6 py-4">
                                <span class="px-2 py-1 rounded-full text-xs font-semibold 
                                    {% if entry.action == 'status_change' %}
                                        bg-blue-100 text-blue-800
                                    {% elif entry.action == 'UPDATE' or entry.action == 'BULK_CHECKOUT' %}
                                        bg-green-100 text-green-800
                                    {% elif entry.action == 'CREATE' %}
                                        bg-yellow-100 text-yellow-800
                                    {% else %}
                                        bg-gray-100 text-gray-800
                                    {% endif %}">
                                    {{ entry.action|capitalize }}
                                </span>
                            </td>
                            <td class="px-6 py-4">
                                {% if entry.changes %}
                                <div class="text-sm">
                                    {% for key, value in entry.changes.items() %}
                                        {% if not (value is mapping and 
                                                  ((value.from == None and value.to == None) or 
                                                   (value.old == None and value.new == None))) %}
                                        <div class="mb-1">
                                            <span class="font-medium">{{ key|replace('_', ' ')|capitalize }}:</span> 
                                            {% if value is mapping %}
                                                {% if 'from' in value and 'to' in value %}
                                                    <span class="line-through text-red-600">{{ value.from or 'None' }}</span> → 
                                                    <span class="text-green-600">{{ value.to or 'None' }}</span>
                                                {% elif 'old' in value and 'new' in value %}
                                                    <span class="line-through text-red-600">{{ value.old or 'None' }}</span> → 
                                                    <span class="text-green-600">{{ value.new or 'None' }}</span>
                                                {% else %}
                                                    {{ value }}
                                                {% endif %}
                                            {% else %}
                                                {{ value }}
                                            {% endif %}
                                        </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                {% endif %}
                                {% if entry.notes %}
                                <div class="mt-2 text-xs text-gray-500">
                                    {{ entry.notes }}
                                </div>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="p-4 mb-4 text-sm text-blue-700 bg-blue-100 rounded-lg" role="alert">
                <span class="font-medium">No history found for this asset</span>
            </div>
            {% endif %}
        </div>

        <!-- Transactions Tab Content -->
        <div id="transactions-content" class="tab-pane hidden">
            {% include 'inventory/asset_transactions.html' %}
        </div>

        <!-- Create Customer Tab Content -->
        {% if current_user.is_admin %}
        <div id="create-customer-content" class="tab-pane hidden">
            <div class="bg-white shadow rounded-lg p-6">
                <div class="flex items-center mb-4">
                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                    </svg>
                    <h2 class="text-lg font-semibold text-gray-900">Create New Customer</h2>
                </div>
                <form action="{{ url_for('inventory.add_customer_user') }}" method="POST" class="space-y-4">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="asset_id" value="{{ asset.id }}">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
                            <input type="text" name="name" id="name" required
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" name="email" id="email" required
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="contact_number" class="block text-sm font-medium text-gray-700">Contact Number</label>
                            <input type="text" name="contact_number" id="contact_number"
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="company" class="block text-sm font-medium text-gray-700">Company</label>
                            <input type="text" name="company" id="company"
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                        </div>
                    </div>
                    
                    <div>
                        <label for="address" class="block text-sm font-medium text-gray-700">Address</label>
                        <textarea name="address" id="address" rows="3"
                                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"></textarea>
                    </div>

                    <div class="flex justify-end">
                        <button type="submit" 
                                class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium transition-colors duration-150">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                            </svg>
                            Create Customer
                        </button>
                    </div>
                </form>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Add the Erase Status Action Modal -->
<div id="eraseStatusModal" class="fixed inset-0 z-50 overflow-y-auto hidden">
    <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 transition-opacity">
            <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
        </div>
        
        <!-- Modal panel -->
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="sm:flex sm:items-start">
                    <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">
                            Update Erase Status
                        </h3>
                        <input type="hidden" id="eraseStatusAssetId" value="{{ asset.id }}">
                        <div class="mt-2">
                            <p class="text-sm text-gray-500 mb-4">Are you sure you want to update the erase status?</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button type="button" id="confirmEraseStatus"
                        class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                    Confirm
                </button>
                <button type="button" id="closeEraseStatusModal"
                        class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm">
                    Cancel
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add JavaScript for handling erase status updates -->
<script>
    let selectedEraseStatus = null;

    function updateEraseStatus(status) {
        selectedEraseStatus = status;
        document.getElementById('eraseStatusModal').classList.remove('hidden');
    }

    document.getElementById('closeEraseStatusModal').addEventListener('click', function() {
        document.getElementById('eraseStatusModal').classList.add('hidden');
        selectedEraseStatus = null;
    });

    document.getElementById('confirmEraseStatus').addEventListener('click', async function() {
        if (!selectedEraseStatus) return;
        
        try {
            const assetId = document.getElementById('eraseStatusAssetId').value;
            const response = await fetch('/inventory/update-erase-status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token() }}'
                },
                body: JSON.stringify({
                    asset_id: parseInt(assetId),
                    erased_status: selectedEraseStatus
                })
            });

            if (!response.ok) {
                throw new Error('Failed to update erase status');
            }

            // Reload the page to show the updated status
            window.location.reload();
        } catch (error) {
            console.error('Error updating erase status:', error);
            alert('Failed to update erase status. Please try again.');
        } finally {
            document.getElementById('eraseStatusModal').classList.add('hidden');
            selectedEraseStatus = null;
        }
    });
</script>
{% endblock %} 