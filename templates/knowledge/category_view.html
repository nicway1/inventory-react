{% extends "base.html" %}

{% block title %}{{ category.name }} - Knowledge Base{% endblock %}

{% block content %}
<!-- Salesforce Knowledge Base Category View -->
<div style="background: #f3f3f3; min-height: 100vh; font-family: 'Salesforce Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;">
    
    <!-- Breadcrumb Navigation -->
    <div style="background: white; border-bottom: 1px solid #e5e5e5; padding: 1rem 0;">
        <div class="container-fluid" style="max-width: 1200px; margin: 0 auto; padding: 0 1rem;">
            <nav style="display: flex; align-items: center; font-size: 0.875rem;">
                <svg style="width: 1rem; height: 1rem; margin-right: 0.5rem; fill: #1589ee;" viewBox="0 0 24 24">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                <a href="{{ url_for('knowledge.index') }}" style="color: #1589ee; text-decoration: none;">Knowledge Base</a>
                {% if category.parent %}
                <span style="margin: 0 0.5rem; color: #706e6b;">></span>
                <a href="{{ url_for('knowledge.view_category', category_id=category.parent.id) }}" style="color: #1589ee; text-decoration: none;">{{ category.parent.name }}</a>
                {% endif %}
                <span style="margin: 0 0.5rem; color: #706e6b;">></span>
                <span style="color: #181818; font-weight: 500;">{{ category.name }}</span>
            </nav>
        </div>
    </div>

    <!-- Category Header -->
    <div style="background: white; border-bottom: 1px solid #e5e5e5; padding: 1.5rem 0;">
        <div class="container-fluid" style="max-width: 1200px; margin: 0 auto; padding: 0 1rem;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center;">
                    <div style="background: #1589ee; padding: 0.75rem; border-radius: 0.5rem; margin-right: 1rem;">
                        <svg style="width: 1.5rem; height: 1.5rem; fill: white;" viewBox="0 0 24 24">
                            <path d="M10 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2h-8l-2-2z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 style="font-size: 1.5rem; font-weight: 600; color: #181818; margin: 0; line-height: 1.2;">{{ category.name }}</h1>
                        {% if category.description %}
                        <p style="font-size: 0.875rem; color: #706e6b; margin: 0.25rem 0 0 0;">{{ category.description }}</p>
                        {% endif %}
                    </div>
                </div>
                {% if current_user.permissions.can_create_articles %}
                <a href="{{ url_for('knowledge.admin_create_article', category_id=category.id) }}" 
                   style="background: #1589ee; color: white; padding: 0.5rem 1rem; border-radius: 0.25rem; text-decoration: none; font-size: 0.875rem; display: flex; align-items: center;">
                    <svg style="width: 1rem; height: 1rem; margin-right: 0.5rem; fill: white;" viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    Add Article
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container-fluid" style="max-width: 1200px; margin: 0 auto; padding: 2rem 1rem;">
        
        <!-- Subcategories -->
        {% if subcategories %}
        <div style="margin-bottom: 2rem;">
            <h2 style="font-size: 1.125rem; font-weight: 600; color: #181818; margin-bottom: 1rem;">Subcategories</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
                {% for subcategory in subcategories %}
                <div style="background: white; border: 1px solid #e5e5e5; border-radius: 0.5rem; padding: 1rem; transition: all 0.2s ease; cursor: pointer;" 
                     onclick="window.location.href='{{ url_for('knowledge.view_category', category_id=subcategory.id) }}'"
                     onmouseover="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'; this.style.transform='translateY(-1px)'"
                     onmouseout="this.style.boxShadow='none'; this.style.transform='translateY(0)'">
                    <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                        <div style="background: #f3f3f3; padding: 0.5rem; border-radius: 0.25rem; margin-right: 0.75rem;">
                            <svg style="width: 1rem; height: 1rem; fill: #706e6b;" viewBox="0 0 24 24">
                                <path d="M10 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2h-8l-2-2z"/>
                            </svg>
                        </div>
                        <h3 style="font-size: 1rem; font-weight: 600; color: #1589ee; margin: 0;">{{ subcategory.name }}</h3>
                    </div>
                    {% if subcategory.description %}
                    <p style="color: #706e6b; font-size: 0.875rem; margin-bottom: 0.75rem; line-height: 1.4;">{{ subcategory.description }}</p>
                    {% endif %}
                    <span style="background: #f3f3f3; color: #706e6b; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.75rem;">
                        {{ subcategory.get_article_count() }} articles
                    </span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Articles Section -->
        <div style="background: white; border: 1px solid #e5e5e5; border-radius: 0.5rem; overflow: hidden;">
            <!-- Articles Header -->
            <div style="background: #f8f9fa; border-bottom: 1px solid #e5e5e5; padding: 1rem 1.5rem;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center;">
                        <svg style="width: 1.25rem; height: 1.25rem; margin-right: 0.5rem; fill: #181818;" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        <h2 style="font-size: 1.125rem; font-weight: 600; color: #181818; margin: 0;">Articles ({{ articles|length }})</h2>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <button onclick="toggleView('list')" id="list-btn" 
                                style="background: #1589ee; color: white; border: 1px solid #1589ee; padding: 0.375rem 0.75rem; border-radius: 0.25rem 0 0 0.25rem; cursor: pointer; font-size: 0.75rem;">
                            <svg style="width: 0.875rem; height: 0.875rem; fill: currentColor;" viewBox="0 0 24 24">
                                <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                            </svg>
                            List
                        </button>
                        <button onclick="toggleView('grid')" id="grid-btn"
                                style="background: white; color: #706e6b; border: 1px solid #e5e5e5; padding: 0.375rem 0.75rem; border-radius: 0 0.25rem 0.25rem 0; cursor: pointer; font-size: 0.75rem;">
                            <svg style="width: 0.875rem; height: 0.875rem; fill: currentColor;" viewBox="0 0 24 24">
                                <path d="M3 11h8V3H3v8zm2-6h4v4H5V5zm8-2v8h8V3h-8zm6 6h-4V5h4v4zM3 21h8v-8H3v8zm2-6h4v4H5v-4zm8-2h8v8h-8v-8zm2 2h4v4h-4v-4z"/>
                            </svg>
                            Grid
                        </button>
                    </div>
                </div>
            </div>

            <!-- Articles Content -->
            {% if articles %}
            <!-- List View -->
            <div id="list-view">
                {% for article in articles %}
                <div style="padding: 1rem 1.5rem; border-bottom: 1px solid #f3f3f3; transition: background-color 0.2s ease;" 
                     onmouseover="this.style.backgroundColor='#f8f9fa'" 
                     onmouseout="this.style.backgroundColor='white'">
                    <div style="display: flex; align-items: flex-start;">
                        <div style="background: #f3f3f3; padding: 0.5rem; border-radius: 0.25rem; margin-right: 1rem; flex-shrink: 0;">
                            <svg style="width: 1rem; height: 1rem; fill: #706e6b;" viewBox="0 0 24 24">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <h3 style="margin: 0 0 0.5rem 0;">
                                <a href="{{ url_for('knowledge.view_article', article_id=article.id) }}" 
                                   style="color: #1589ee; text-decoration: none; font-weight: 500; font-size: 1rem; line-height: 1.3;">
                                    {{ article.title }}
                                </a>
                            </h3>
                            {% if article.summary %}
                            <p style="color: #706e6b; font-size: 0.875rem; margin: 0 0 0.75rem 0; line-height: 1.4;">
                                {{ article.summary[:120] }}{% if article.summary|length > 120 %}...{% endif %}
                            </p>
                            {% else %}
                            <p style="color: #706e6b; font-size: 0.875rem; margin: 0 0 0.75rem 0; line-height: 1.4;">
                                {{ (article.content | striptags)[:120] }}{% if article.content|length > 120 %}...{% endif %}
                            </p>
                            {% endif %}
                            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; color: #706e6b;">
                                <div>
                                    <span>By {{ article.author.username }} • {{ article.view_count }} views</span>
                                    {% if article.tags %}
                                    <div style="margin-top: 0.5rem;">
                                        {% for tag in article.tags %}
                                        <span style="background: #e5e5e5; color: #706e6b; padding: 0.125rem 0.5rem; border-radius: 0.75rem; font-size: 0.625rem; margin-right: 0.25rem;">{{ tag.name }}</span>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                                <span>Updated {{ article.updated_at|localtime('%b %d, %Y') }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Grid View -->
            <div id="grid-view" style="display: none; padding: 1rem;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    {% for article in articles %}
                    <div style="background: #f8f9fa; border: 1px solid #e5e5e5; border-radius: 0.5rem; padding: 1rem; transition: all 0.2s ease; cursor: pointer;"
                         onclick="window.location.href='{{ url_for('knowledge.view_article', article_id=article.id) }}'"
                         onmouseover="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'; this.style.transform='translateY(-1px)'"
                         onmouseout="this.style.boxShadow='none'; this.style.transform='translateY(0)'">
                        <h3 style="font-size: 1rem; font-weight: 600; color: #1589ee; margin: 0 0 0.75rem 0; line-height: 1.3;">
                            {{ article.title }}
                        </h3>
                        {% if article.summary %}
                        <p style="color: #706e6b; font-size: 0.875rem; margin: 0 0 1rem 0; line-height: 1.4;">
                            {{ article.summary[:100] }}{% if article.summary|length > 100 %}...{% endif %}
                        </p>
                        {% else %}
                        <p style="color: #706e6b; font-size: 0.875rem; margin: 0 0 1rem 0; line-height: 1.4;">
                            {{ (article.content | striptags)[:100] }}{% if article.content|length > 100 %}...{% endif %}
                        </p>
                        {% endif %}
                        <div style="font-size: 0.75rem; color: #706e6b;">
                            <div>{{ article.view_count }} views • {{ article.updated_at|localtime('%b %d, %Y') }}</div>
                            {% if article.tags %}
                            <div style="margin-top: 0.5rem;">
                                {% for tag in article.tags %}
                                <span style="background: #e5e5e5; color: #706e6b; padding: 0.125rem 0.5rem; border-radius: 0.75rem; font-size: 0.625rem; margin-right: 0.25rem;">{{ tag.name }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <!-- No Articles -->
            <div style="text-align: center; padding: 4rem 2rem;">
                <div style="background: #f3f3f3; width: 4rem; height: 4rem; border-radius: 50%; margin: 0 auto 1.5rem; display: flex; align-items: center; justify-content: center;">
                    <svg style="width: 2rem; height: 2rem; fill: #706e6b;" viewBox="0 0 24 24">
                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                    </svg>
                </div>
                <h3 style="font-size: 1.25rem; font-weight: 600; color: #181818; margin-bottom: 0.5rem;">No articles in this category</h3>
                <p style="color: #706e6b; margin-bottom: 1.5rem;">Be the first to add an article to this category!</p>
                {% if current_user.permissions.can_create_articles %}
                <a href="{{ url_for('knowledge.admin_create_article', category_id=category.id) }}" 
                   style="background: #1589ee; color: white; padding: 0.75rem 1.5rem; border-radius: 0.25rem; text-decoration: none; font-weight: 500; display: inline-flex; align-items: center;">
                    <svg style="width: 1rem; height: 1rem; margin-right: 0.5rem; fill: white;" viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    Create Article
                </a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
/* Hover effects */
a:hover {
    text-decoration: underline !important;
}

/* Responsive */
@media (max-width: 768px) {
    div[style*="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr))"] {
        grid-template-columns: 1fr !important;
    }
    
    div[style*="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr))"] {
        grid-template-columns: 1fr !important;
    }
    
    div[style*="display: flex; align-items: center; justify-content: space-between"] {
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: 1rem;
    }
}
</style>

<script>
function toggleView(viewType) {
    const listView = document.getElementById('list-view');
    const gridView = document.getElementById('grid-view');
    const listBtn = document.getElementById('list-btn');
    const gridBtn = document.getElementById('grid-btn');
    
    if (viewType === 'list') {
        listView.style.display = 'block';
        gridView.style.display = 'none';
        
        // Update button styles
        listBtn.style.background = '#1589ee';
        listBtn.style.color = 'white';
        listBtn.style.borderColor = '#1589ee';
        
        gridBtn.style.background = 'white';
        gridBtn.style.color = '#706e6b';
        gridBtn.style.borderColor = '#e5e5e5';
    } else {
        listView.style.display = 'none';
        gridView.style.display = 'block';
        
        // Update button styles
        gridBtn.style.background = '#1589ee';
        gridBtn.style.color = 'white';
        gridBtn.style.borderColor = '#1589ee';
        
        listBtn.style.background = 'white';
        listBtn.style.color = '#706e6b';
        listBtn.style.borderColor = '#e5e5e5';
    }
}
</script>
{% endblock %}