{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Back Button -->
    <div class="mb-6">
        <a href="{{ url_for('sales.dashboard') }}" 
           class="text-blue-600 hover:text-blue-800">
            &larr; Back to Dashboard
        </a>
    </div>

    <div class="max-w-2xl mx-auto">
        <div class="bg-white shadow-lg rounded-lg overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-900">Record New Sale</h2>
                <p class="mt-1 text-sm text-gray-600">Enter the details of the sale.</p>
            </div>

            <div class="p-6">
                <form method="POST" class="space-y-6">
                    <!-- Product Selection -->
                    <div>
                        <label for="product_id" class="block text-sm font-medium text-gray-700">Product</label>
                        <select id="product_id" 
                                name="product_id" 
                                required
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                            <option value="">Select a product...</option>
                            {% for product in products %}
                            <option value="{{ product.id }}" data-cost="{{ product.cost_price }}">
                                {{ product.asset_tag }} - {{ product.model }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Platform -->
                    <div>
                        <label for="platform" class="block text-sm font-medium text-gray-700">Platform</label>
                        <select id="platform" 
                                name="platform" 
                                required
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                            <option value="">Select a platform...</option>
                            {% for platform in platforms %}
                            <option value="{{ platform.name }}">{{ platform.value }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Selling Price -->
                    <div>
                        <label for="selling_price" class="block text-sm font-medium text-gray-700">Selling Price</label>
                        <div class="mt-1 relative rounded-md shadow-sm">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-500 sm:text-sm">$</span>
                            </div>
                            <input type="number" 
                                   id="selling_price" 
                                   name="selling_price" 
                                   required
                                   step="0.01"
                                   min="0"
                                   class="pl-7 block w-full rounded-md border-gray-300 shadow-sm"
                                   onchange="calculateProfit()">
                        </div>
                    </div>

                    <!-- Profit Preview -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Estimated Profit</label>
                        <div class="mt-1 text-lg font-semibold text-gray-900" id="profit-preview">$0.00</div>
                    </div>

                    <!-- Customer Name -->
                    <div>
                        <label for="customer_name" class="block text-sm font-medium text-gray-700">Customer Name</label>
                        <input type="text" 
                               id="customer_name" 
                               name="customer_name" 
                               required
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>

                    <!-- Sale Date -->
                    <div>
                        <label for="sale_date" class="block text-sm font-medium text-gray-700">Sale Date</label>
                        <input type="date" 
                               id="sale_date" 
                               name="sale_date" 
                               value="{{ today }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>

                    <!-- Notes -->
                    <div>
                        <label for="notes" class="block text-sm font-medium text-gray-700">Notes</label>
                        <textarea id="notes" 
                                  name="notes" 
                                  rows="3"
                                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
                    </div>

                    <!-- Submit Button -->
                    <div>
                        <button type="submit"
                                class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Record Sale
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function calculateProfit() {
    const productSelect = document.getElementById('product_id');
    const selectedOption = productSelect.options[productSelect.selectedIndex];
    const costPrice = selectedOption ? parseFloat(selectedOption.dataset.cost) : 0;
    const sellingPrice = parseFloat(document.getElementById('selling_price').value) || 0;
    
    const profit = sellingPrice - costPrice;
    document.getElementById('profit-preview').textContent = 
        `$${profit.toFixed(2)} (${((profit/costPrice) * 100).toFixed(1)}%)`;
}

document.getElementById('product_id').addEventListener('change', calculateProfit);
document.getElementById('selling_price').addEventListener('input', calculateProfit);

// Set default date to today
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('sale_date').value = today;
});
</script>
{% endblock %} 