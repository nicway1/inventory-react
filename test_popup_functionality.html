<!DOCTYPE html>
<html>
<head>
    <title>ğŸ” Add Tracking Popup Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-section { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 10px 0; border-radius: 4px; border-left: 4px solid; }
        .success { background: #d4edda; color: #155724; border-left-color: #28a745; }
        .error { background: #f8d7da; color: #721c24; border-left-color: #dc3545; }
        .info { background: #d1ecf1; color: #0c5460; border-left-color: #17a2b8; }
        .warning { background: #fff3cd; color: #856404; border-left-color: #ffc107; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        .btn-test { background: #28a745; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        code { background: #f8f9fa; padding: 2px 8px; border-radius: 3px; font-family: monospace; color: #e83e8c; }
        .step { background: #f8f9fa; padding: 10px; margin: 10px 0; border-left: 3px solid #007bff; }
        .popup-demo { border: 2px dashed #007bff; padding: 15px; margin: 15px 0; text-align: center; }
    </style>
</head>
<body>
    <h1>ğŸ” Add Tracking Popup Functionality Test</h1>
    
    <div class="test-section">
        <h2>ğŸ¯ What Should Happen When You Click "Add Tracking":</h2>
        
        <div class="step">
            <strong>Step 1:</strong> First popup appears asking for <strong>tracking number</strong>
            <div class="popup-demo">
                <strong>ğŸ“‹ Popup 1:</strong> "Enter tracking number:"<br>
                <em>Example: TEST123456, CLAW789123, etc.</em>
            </div>
        </div>
        
        <div class="step">
            <strong>Step 2:</strong> Second popup appears asking for <strong>carrier</strong>
            <div class="popup-demo">
                <strong>ğŸ“‹ Popup 2:</strong> "Enter carrier (auto, singpost, dhl, ups, claw, etc.):"<br>
                <em>Example: claw, singpost, dhl, ups, auto</em>
            </div>
        </div>
        
        <div class="step">
            <strong>Step 3:</strong> Function attempts to save tracking info via API
            <div class="popup-demo">
                <strong>ğŸ”„ Processing:</strong> Button shows "Adding..." while saving
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª Quick Test - Simulate the Popup Functionality:</h2>
        <button class="btn-test" onclick="testPopupFlow()">ğŸ§ª Test Popup Flow</button>
        <button class="btn-info" onclick="showExpectedBehavior()">ğŸ“‹ Show Expected Behavior</button>
        
        <div id="testResult"></div>
    </div>

    <div class="test-section">
        <h2>âœ… Expected Console Messages:</h2>
        <p>When you click "Add Tracking" on your Asset Checkout (Claw) ticket, you should see these in the browser console (F12):</p>
        
        <div class="status info">
            <code>âœ… "Setting up Add Tracking button event listener"</code><br>
            <code>âœ… "Add Tracking button clicked"</code><br>
            <code>âœ… "showAddShipmentModal called"</code><br>
            <code>âœ… "Adding tracking number: [your_number] with carrier: [your_carrier]"</code>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ If Popups Don't Appear:</h2>
        
        <div class="status warning">
            <strong>Possible Issues:</strong>
            <ul>
                <li><strong>Browser blocked popups</strong> - Check if popup blocker is enabled</li>
                <li><strong>JavaScript error</strong> - Check browser console for errors</li>
                <li><strong>Button not properly connected</strong> - Event listener not set up</li>
                <li><strong>Cache issue</strong> - Clear browser cache and reload</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ› ï¸ Debug Steps:</h2>
        <ol>
            <li><strong>Open browser console</strong> (F12 â†’ Console tab)</li>
            <li><strong>Go to your Asset Checkout (Claw) ticket</strong></li>
            <li><strong>Check if this appears:</strong> <code>"Setting up Add Tracking button event listener"</code></li>
            <li><strong>Click "Add Tracking" button</strong></li>
            <li><strong>Look for:</strong> <code>"Add Tracking button clicked"</code></li>
            <li><strong>Check if popup appears asking for tracking number</strong></li>
        </ol>
    </div>

    <div class="test-section">
        <h2>ğŸ‰ Success Criteria:</h2>
        <div class="status success">
            âœ… First popup: "Enter tracking number:" appears<br>
            âœ… Second popup: "Enter carrier:" appears<br>
            âœ… Button changes to "Adding..." during processing<br>
            âœ… No JavaScript errors in console<br>
            âœ… Function attempts to save via API
        </div>
    </div>

    <script>
        function testPopupFlow() {
            const result = document.getElementById('testResult');
            result.innerHTML = '<div class="status info">ğŸ§ª Testing popup flow...</div>';
            
            try {
                // Simulate the exact same flow as the real function
                console.log('ğŸ§ª TEST: showAddShipmentModal called');
                
                const trackingNumber = prompt('ğŸ§ª TEST: Enter tracking number:');
                if (trackingNumber && trackingNumber.trim()) {
                    const carrier = prompt('ğŸ§ª TEST: Enter carrier (auto, singpost, dhl, ups, claw, etc.):') || 'claw';
                    
                    console.log('ğŸ§ª TEST: Adding tracking number:', trackingNumber, 'with carrier:', carrier);
                    
                    result.innerHTML = `
                        <div class="status success">
                            âœ… <strong>Test Successful!</strong><br>
                            ğŸ“¦ Tracking Number: <code>${trackingNumber}</code><br>
                            ğŸšš Carrier: <code>${carrier}</code><br>
                            <em>This is exactly how your real Add Tracking button should work!</em>
                        </div>
                    `;
                } else if (trackingNumber === '') {
                    result.innerHTML = '<div class="status warning">âš ï¸ Empty tracking number entered</div>';
                } else {
                    result.innerHTML = '<div class="status info">â„¹ï¸ Test cancelled by user</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="status error">âŒ Error during test: ${error.message}</div>`;
            }
        }
        
        function showExpectedBehavior() {
            const result = document.getElementById('testResult');
            result.innerHTML = `
                <div class="status info">
                    <strong>ğŸ“‹ Expected Behavior Sequence:</strong><br><br>
                    
                    <strong>1. Click "Add Tracking" â†’</strong> <code>prompt("Enter tracking number:")</code><br>
                    <strong>2. Enter tracking number â†’</strong> <code>prompt("Enter carrier:")</code><br>
                    <strong>3. Enter carrier â†’</strong> Function processes the data<br>
                    <strong>4. API call made â†’</strong> Button shows "Adding..."<br>
                    <strong>5. Success/Error â†’</strong> Page reloads or error message<br><br>
                    
                    <em>If you don't see step 1 (first popup), there's still an issue with the button setup.</em>
                </div>
            `;
        }
        
        // Test Flask connection
        async function testFlaskConnection() {
            try {
                const response = await fetch('http://127.0.0.1:5004/');
                console.log('Flask connection test:', response.ok ? 'âœ… Connected' : 'âŒ Failed');
            } catch (error) {
                console.log('Flask connection test: âŒ Error -', error.message);
            }
        }
        
        // Auto-test Flask connection
        setTimeout(testFlaskConnection, 1000);
    </script>
</body>
</html> 